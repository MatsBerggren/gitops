# Minimal, homelab-friendly kube-prometheus-stack values.
# Alertmanager config is supplied by Secret:
#   alertmanager-kube-prometheus-stack-alertmanager (managed by apps/monitoring/alerting)

prometheus:
  prometheusSpec:
    externalUrl: https://monitoring.support4u.se
    routePrefix: /

    retention: 15d
    scrapeInterval: 30s
    evaluationInterval: 30s

    # Allow ServiceMonitors/PodMonitors/Probes created outside this Helm release
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    probeSelectorNilUsesHelmValues: false
    ruleSelectorNilUsesHelmValues: false

alertmanager:
  enabled: true
  alertmanagerSpec:
    routePrefix: /alertmanager
    externalUrl: https://monitoring.support4u.se/alertmanager

  # Let the chart manage the Secret (plaintext, per your accepted tradeoff)
  config:
    global:
      resolve_timeout: 5m

    route:
      receiver: telegram
      group_by: ['alertname','namespace']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 4h

    receivers:
      # Drop Watchdog (and any other routes we point at this receiver)
      - name: "null"

      - name: telegram
        telegram_configs:
          - bot_token: '8565060282:AAE1WALNgES6_s1Lo-tbkDqFD2Q-naNB7vk'
            chat_id: 8043105925
            send_resolved: true
            parse_mode: 'HTML'

grafana:
  enabled: true

  grafana.ini:
    server:
      root_url: https://monitoring.support4u.se/grafana
      serve_from_sub_path: true

  # Keep it simple; we already create an Ingress separately.
  service:
    port: 80

  # If you want persistence later, we can enable it and add a PVC.
  persistence:
    enabled: false

# Reduce noise for small clusters
defaultRules:
  create: true

kubeControllerManager:
  enabled: true
kubeScheduler:
  enabled: true
kubeEtcd:
  enabled: true
