apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: wordpress

resources:
  - ../../base
  - mariadb-tuning-configmap.yaml
  - wp-php-ini-configmap.yaml
  # One-shot migration job: run once, then delete/disable.
  - wp-content-migrate-job.yaml
  - wp-nginx-configmap.yaml

patches:
  # 1) Resurser (CPU/MEM) f√∂r Wordpress
  - path: wordpress-resources-patch.yaml
    target:
      group: apps
      version: v1
      kind: Deployment
      name: wordpress
      namespace: wordpress

  # 2) Redis-env & WORDPRESS_CONFIG_EXTRA
  - path: wordpress-env-patch.yaml
    target:
      group: apps
      version: v1
      kind: Deployment
      name: wordpress
      namespace: wordpress

  # 3) Ingress-cache (nginx annotations)
  - path: wordpress-ingress-cache-patch.yaml
    target:
      group: networking.k8s.io
      version: v1
      kind: Ingress
      name: wordpress
      namespace: wordpress
